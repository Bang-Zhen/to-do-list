<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Together - Shared Calendar & To-Do</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Emoji fonts loaded via CSS @font-face -->
    <link rel="stylesheet" href="/styles.css">
    
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Loading Together...</p>
    </div>

    <!-- Authentication Modal -->
    <div id="auth-modal" class="modal auth-modal">
        <div class="modal-content auth-content">
            <div class="auth-header">
                <h2>Welcome to Together</h2>
                <p>Your shared calendar and to-do companion</p>
            </div>
            
            <div id="login-form" class="auth-form">
                <h3>Sign In</h3>
                <form id="email-login-form">
                    <div class="form-group">
                        <input type="email" id="login-email" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="login-password" placeholder="Password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="btn btn-primary full-width">
                        <span>Sign In</span>
                        <span class="button-loader" style="display: none;"></span>
                    </button>
                </form>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button id="google-login-btn" class="btn btn-google full-width">
                    <span class="google-icon">G</span>
                    Continue with Google
                </button>
                
                <p class="auth-switch">
                    Don't have an account? <a href="#" id="show-signup">Sign up</a>
                </p>
            </div>
            
            <div id="signup-form" class="auth-form" style="display: none;">
                <h3>Create Account</h3>
                <form id="email-signup-form">
                    <div class="form-group">
                        <input type="text" id="signup-name" placeholder="Your Name" required>
                    </div>
                    <div class="form-group">
                        <input type="email" id="signup-email" placeholder="Email" required>
                    </div>
                    <div class="form-group">
                        <input type="password" id="signup-password" placeholder="Password (6+ characters)" required minlength="6" autocomplete="new-password">
                    </div>
                    <button type="submit" class="btn btn-primary full-width">
                        <span>Create Account</span>
                        <span class="button-loader" style="display: none;"></span>
                    </button>
                </form>
                
                <div class="auth-divider">
                    <span>or</span>
                </div>
                
                <button id="google-signup-btn" class="btn btn-google full-width">
                    <span class="google-icon">G</span>
                    Sign up with Google
                </button>
                
                <p class="auth-switch">
                    Already have an account? <a href="#" id="show-login">Sign in</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Workspace Setup Modal -->
    <div id="workspace-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Create Your Shared Space</h3>
            </div>
            <form id="workspace-form">
                <div class="form-group">
                    <label>Workspace Name</label>
                    <input type="text" id="workspace-name" placeholder="Alex & Blake's Calendar" required>
                </div>
                <div class="form-group">
                    <label>Choose Theme</label>
                    <div class="theme-selector">
                        <div class="theme-option active" data-theme="default">
                            <div class="theme-preview theme-default"></div>
                            <span>Default</span>
                        </div>
                        <div class="theme-option" data-theme="sunset">
                            <div class="theme-preview theme-sunset"></div>
                            <span>Sunset</span>
                        </div>
                        <div class="theme-option" data-theme="forest">
                            <div class="theme-preview theme-forest"></div>
                            <span>Forest</span>
                        </div>
                        <div class="theme-option" data-theme="cosmic-horizon">
                            <div class="theme-preview theme-cosmic-horizon"></div>
                            <span>Cosmic Horizon</span>
                        </div>
                        <div class="theme-option" data-theme="ocean-breeze">
                            <div class="theme-preview theme-ocean-breeze"></div>
                            <span>Ocean Breeze</span>
                        </div>
                    </div>
                </div>
                <div class="btn-group">
                    <button type="submit" class="btn btn-primary">
                        <span>Create Workspace</span>
                        <span class="button-loader" style="display: none;"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Join Workspace Modal -->
    <div id="join-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Join Shared Space</h3>
                <button class="close-btn" onclick="closeModal('join-modal')">&times;</button>
            </div>
            <form id="join-form">
                <div class="form-group">
                    <label>Invitation Code</label>
                    <input type="text" id="join-code" placeholder="Enter 6-digit code" maxlength="6" required>
                </div>
                <p class="helper-text">Ask your partner for the invitation code from their app</p>
                <div class="btn-group">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('join-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span>Join Workspace</span>
                        <span class="button-loader" style="display: none;"></span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Main App Container -->
    <div class="app-container" id="main-app" style="display: none;">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <div class="workspace-title-container">
                    <h1 id="workspace-title">Together</h1>
                    <button id="edit-workspace-name-btn" class="edit-workspace-btn" title="Edit workspace name">‚úèÔ∏è</button>
                </div>
                <span id="workspace-subtitle"></span>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="showInviteModal()" data-tooltip="Share Workspace">üì§</button>
                <button class="header-btn" onclick="showJoinModal()" data-tooltip="Join Workspace">‚ûï</button>
                <button class="header-btn" onclick="showMembersModal()" data-tooltip="Manage Members">üë•</button>
                <button class="header-btn" onclick="showThemeModal()" data-tooltip="Change Theme">üé®</button>
                <button class="header-btn" onclick="showEventColorsModal()" data-tooltip="Personalize Event Colors">üñåÔ∏è</button>
                <div class="user-info">
                    <div class="user-avatar" id="current-user-avatar" data-tooltip="Profile Settings">U</div>
                    <div class="user-avatar" id="partner-avatar" style="display: none;">P</div>
                </div>
                <button class="header-btn logout-btn" onclick="signOut()" data-tooltip="Sign Out">üö™</button>
            </div>
        </div>

        <!-- Connection Status -->
        <div id="connection-status" class="connection-status" style="display: none;">
            <span id="status-text">Connecting...</span>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('calendar')" data-tooltip="View and manage your calendar">üìÖ Calendar</button>
            <button class="tab-btn" onclick="switchTab('my-tasks')" data-tooltip="View your personal tasks">‚úÖ My Tasks</button>
            <button class="tab-btn" onclick="switchTab('partner-tasks')" data-tooltip="View partner's tasks">üë• <span id="partner-tab-name">Partner's Tasks</span></button>
            <button class="tab-btn" onclick="switchTab('shared-tasks')" data-tooltip="View shared tasks">‚ù§Ô∏è Shared Tasks</button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Calendar View -->
            <div id="calendar-view" class="calendar-container">
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="changeMonth(-1)">‚Äπ</button>
                        <div class="month-year" id="monthYear">January 2024</div>
                        <button class="nav-btn" onclick="changeMonth(1)">‚Ä∫</button>
                    </div>
                    <button class="add-event-btn" onclick="openModal('add-event-choice-modal');" data-tooltip="Add an event to your calendar">+ Add Event</button>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Calendar will be generated here -->
                </div>
            </div>

            <!-- My Tasks View -->
            <div id="my-tasks-view" class="todo-container hidden">
                <div class="todo-header">
                    <h2 class="section-title">My Tasks</h2>
                    <button class="add-event-btn" onclick="openTodoModal('user1')">+ Add Task</button>
                </div>
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div id="my-tasks-progress-bar" class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div id="my-tasks-progress-text" class="progress-text">0% Complete</div>
                </div>
                <div class="todo-lists">
                    <div class="todo-list full-width">
                        <div id="user1-todos" class="todo-list-content">
                            <!-- User 1 todos will be generated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Partner Tasks View -->
            <div id="partner-tasks-view" class="todo-container hidden">
                <div class="todo-header">
                    <h2 class="section-title" id="partner-view-title">Partner's Tasks</h2>
                    <button class="add-event-btn" onclick="openTodoModal('user2')">+ Add Task</button>
                </div>
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div id="partner-tasks-progress-bar" class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div id="partner-tasks-progress-text" class="progress-text">0% Complete</div>
                </div>
                <div class="todo-lists">
                    <div class="todo-list full-width">
                        <div id="user2-todos" class="todo-list-content">
                            <!-- User 2 todos will be generated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Shared Tasks View -->
            <div id="shared-tasks-view" class="todo-container hidden">
                <div class="todo-header">
                    <h2 class="section-title">Shared Tasks</h2>
                    <button class="add-event-btn" onclick="openTodoModal('shared')">+ Add Shared Task</button>
                </div>
                <!-- Progress Bar -->
                <div class="progress-container">
                    <div id="shared-tasks-progress-bar" class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div id="shared-tasks-progress-text" class="progress-text">0% Complete</div>
                </div>
                <div class="todo-lists">
                    <div class="todo-list full-width">
                        <div id="shared-todos" class="todo-list-content">
                            <!-- Shared todos will be generated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Profile Settings</h3>
                    <button class="close-btn" onclick="closeModal('settingsModal')">&times;</button>
                </div>
                <div class="settings-section">
                    <form id="profile-settings-form">
                        <div class="form-group">
                            <label>Display Name</label>
                            <input type="text" id="settings-name" required>
                        </div>
                        <div class="form-group">
                            <label>Birthday</label>
                            <input type="date" id="settings-birthday" required>
                        </div>
                        <div class="form-group">
                            <label>Bio</label>
                            <textarea id="settings-bio" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>Save Profile</span>
                            <span class="button-loader" style="display: none;"></span>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Event Modal -->
        <div id="eventModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="event-modal-title">Personal Event</h3>
                    <button class="close-btn" onclick="closeModal('eventModal')">&times;</button>
                </div>
                <form id="eventForm">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="eventTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="date" id="eventStartDate" required>
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="date" id="eventEndDate">
                    </div>
                    <div class="form-group time-group">
                        <label>Start Time (optional)</label>
                        <input type="time" id="eventStartTime">
                    </div>
                    <div class="form-group time-group">
                        <label>End Time (optional)</label>
                        <input type="time" id="eventEndTime">
                    </div>
                    <div class="form-group">
                        <label>Location</label>
                        <input type="text" id="eventLocation">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="eventNotes" rows="3"></textarea>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('eventModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <span id="event-save-text">Save Event</span>
                            <span id="event-save-loader" class="button-loader" style="display: none;"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Todo Modal -->
        <div id="todoModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Add Task</h3>
                    <button class="close-btn" onclick="closeModal('todoModal')">&times;</button>
                </div>
                <form id="todoForm">
                    <div class="form-group">
                        <label>Task</label>
                        <input type="text" id="todoTitle" required>
                    </div>
                    <div class="form-group">
                        <label>Due Date</label>
                        <input type="date" id="todoDueDate">
                    </div>
                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="todoNotes" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Assign to</label>
                        <select id="todoAssignee" required>
                            <option value="">Select person</option>
                            <option value="user1">Me</option>
                            <option value="user2">Partner</option>
                            <option value="shared">Both (Shared)</option>
                        </select>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('todoModal')">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <span id="todo-save-text">Save Task</span>
                            <span id="todo-save-loader" class="button-loader" style="display: none;"></span>
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Theme Modal -->
        <div id="themeModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Choose Theme</h3>
                    <button class="close-btn" onclick="closeModal('themeModal')">&times;</button>
                </div>
                <div class="theme-grid">
                    <div class="theme-card" data-theme="sunset">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #ff9a8b, #ff6a88)"></div>
                        <span>Sunset</span>
                    </div>
                    <div class="theme-card" data-theme="forest">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #2d5a27, #90a955)"></div>
                        <span>Forest</span>
                    </div>
                    <div class="theme-card" data-theme="lavender">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #9795ef, #f9c5d1)"></div>
                        <span>Lavender</span>
                    </div>
                    <div class="theme-card" data-theme="midnight">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #0f2027, #203a43)"></div>
                        <span>Midnight</span>
                    </div>
                    <div class="theme-card" data-theme="aurora">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #20bf55, #01baef)"></div>
                        <span>Aurora</span>
                    </div>
                    <div class="theme-card" data-theme="desert">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #f9b16e, #f68080)"></div>
                        <span>Desert</span>
                    </div>
                    <div class="theme-card" data-theme="cosmic">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #3a1c71, #d76d77)"></div>
                        <span>Cosmic</span>
                    </div>
                    <div class="theme-card" data-theme="cosmic-horizon">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #9600FF 0%, #AEBAF8 100%)"></div>
                        <span>Cosmic Horizon</span>
                    </div>
                    <div class="theme-card" data-theme="ocean-breeze">
                        <div class="theme-preview" style="background: linear-gradient(135deg, #07A3B2 0%, #D9ECC7 100%)"></div>
                        <span>Ocean Breeze</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Event Colors Modal -->
        <div id="eventColorsModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">‚ú® Customize Personal Event Colors ‚ú®</h3>
                    <button class="close-btn" onclick="closeModal('eventColorsModal')">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="color-settings">
                        <div class="color-section">
                            <div class="color-item">
                                <div class="color-label">
                                    <span class="user-label">My Events</span>
                                    <span class="color-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" onclick="openEventColorPicker('user1')"></span>
                                </div>
                                <input type="color" id="user1-event-color" value="#667eea" style="display: none;">
                            </div>
                            <div class="color-item">
                                <div class="color-label">
                                    <span class="user-label">Partner's Events</span>
                                    <span class="color-preview" style="background: linear-gradient(135deg, #ff9a8b 0%, #fecfef 100%);" onclick="openEventColorPicker('user2')"></span>
                                </div>
                                <input type="color" id="user2-event-color" value="#ff9a8b" style="display: none;">
                            </div>
                        </div>

                        <div class="color-hint">
                            <p>üé® Click on any color to customize it!</p>
                            <p>Shared events always use the theme's gradient colors and cannot be customized.</p>
                            <p>Your calendar events will automatically update with the new colors.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="btn-group">
                        <button type="button" class="btn btn-secondary" onclick="resetEventColors()">Reset to Default</button>
                        <button type="button" class="btn btn-primary" onclick="saveEventColors()">
                            <span>Save Colors</span>
                            <span class="button-loader" style="display: none;"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Manage Members Modal -->
        <div id="membersModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Manage Members</h3>
                    <button class="close-btn" onclick="closeModal('membersModal')">&times;</button>
                </div>
                <div class="members-list" id="membersList">
                    <!-- Members will be listed here -->
                </div>
            </div>
        </div>

        <!-- Day Events Modal -->
        <div id="day-events-modal" class="modal">
            <div class="modal-content day-events-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="day-events-title">Events for <span id="selected-date-text"></span></h3>
                    <button class="close-btn" onclick="closeModal('day-events-modal')">&times;</button>
                </div>
                <div class="day-events-container">
                    <div id="day-events-list" class="day-events-list">
                        <!-- Events will be populated here -->
                    </div>
                    <div class="day-events-actions">
                        <button class="personal-event-btn" style="background: linear-gradient(135deg, #FFE5D9 0%, #FFBE9C 30%, #FFA06B 60%, #FF8C41 100%) !important;" onclick="openEventModal(document.getElementById('day-events-modal').dataset.selectedDate)">
                            <span>+ Personal Event</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invite Modal -->
        <div id="invite-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title">Invite Partner</h3>
                    <button class="close-btn" onclick="closeModal('invite-modal')">&times;</button>
                </div>
                <div class="invite-content">
                    <div class="invite-code-section">
                        <label>Share this code with your partner:</label>
                        <div class="invite-code-display">
                            <span id="invite-code-text">------</span>
                            <button class="copy-btn" onclick="copyInviteCode()">üìã</button>
                        </div>
                    </div>
                    <div class="auth-divider"><span>or</span></div>
                    <form id="email-invite-form">
                        <div class="form-group">
                            <label>Send email invitation:</label>
                            <input type="email" id="invite-email" placeholder="partner@example.com">
                        </div>
                        <button type="submit" class="btn btn-primary full-width">Send Invitation</button>
                    </form>
                </div>
            </div>
        </div>
        <!-- Add Event Choice Modal -->
        <div id="add-event-choice-modal" class="modal add-event-choice-modal">
            <div class="modal-content add-event-choice-content">
                <div class="modal-header">
                    <h3 class="modal-title">What would you like to add?</h3>
                    <button class="close-btn" onclick="closeModal('add-event-choice-modal')">&times;</button>
                </div>
                <div class="choice-grid">
                    <div class="choice-option personal-event" onclick="closeModal('add-event-choice-modal'); openEventModal(null, true, false)">
                    <div class="choice-emoji">üìù</div>
                    <div class="choice-title">Personal Event</div>
                    <div class="choice-description">have funnnnn</div>
                </div>
                <div class="choice-option shared-memory" onclick="closeModal('add-event-choice-modal'); openEventModal(null, true, true)">
                    <div class="choice-emoji">üíù</div>
                    <div class="choice-title">spend time with baobei</div>
                    <div class="choice-description">click me for baobei time</div>
                </div>
        </div>
    </div>

    <script src="/script.js" type="module"></script>
    <!-- Event Color Persistence Test (enabled for debugging) -->
    <script src="/test-color-persistence.js"></script>
</body>
</html>